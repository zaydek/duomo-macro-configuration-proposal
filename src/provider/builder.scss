@use "sass:map";

@use "core/width";

@use "configuration";
@use "escapers";
@use "getters";
@use "resolvers";

@mixin build($options) {
	$breakpoint-delimiter: escapers.escape(configuration.$breakpoint-delimiter);

	$shorthand: map.get($options, shorthand);
	$property: map.get($options, property);
	$type: map.get($options, type);
	$range: map.get($options, range);
	$resolver: map.get($options, resolver);
	$breakpoints: map.get($options, breakpoints);
	$pseudo: map.get($options, pseudo);

	@if $type == range {
		@each $rv in $range {
			.#{$shorthand}-#{$rv} {
				#{$property}: $rv;
			}
		}
	}
	@each $k, $v in getters.breakpoints() {
		@media (min-width: resolvers.px($v)) {
			.#{$k} {
				@if $type == range {
					@each $rv in $range {
						&#{$breakpoint-delimiter}#{$shorthand}-#{$rv} {
							#{$property}: resolvers.resolve($rv, $resolver);
						}
					}
				}
			}
		}
	}
}

// TODO: Add `$headless` option here?
@at-root {
	@include build(width.$options);
}
